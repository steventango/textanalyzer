"use strict"; window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null; var t=[void 0],e="zero-timeout-message",r=function(r){var a=t.length; return t.push(r),window.postMessage(e+a.toString(36),"*"),a;}; return window.addEventListener("message",function(r){if("string"==typeof r.data&&r.data.substr(0,e.length)===e){r.stopImmediatePropagation(); var a=parseInt(r.data.substr(e.length),36); t[a]&&(t[a](),t[a]=void 0);}},!0),window.clearImmediate=function(e){t[e]&&(t[e]=void 0);},r;}()||function(t){window.setTimeout(t,0);};}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t);};}()),function(t){var e=function(){var t=document.createElement("canvas"); if(!t||!t.getContext)return!1; var e=t.getContext("2d"); return!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push));}(),r=function(){if(e){for(var t,r,a=document.createElement("canvas").getContext("2d"),i=20; i;){if(a.font=i.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===r)return i+1; t=a.measureText("Ｗ").width,r=a.measureText("m").width,i--;}return 0;}}(),a=function(t){for(var e,r,a=t.length; a; e=Math.floor(Math.random()*a),r=t[--a],t[a]=t[e],t[e]=r);return t;},i=function(t,i){function o(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)";}if(e){Array.isArray(t)||(t=[t]),t.forEach(function(e,r){if("string"==typeof e){if(t[r]=document.getElementById(e),!t[r])throw"The element id specified is not found.";}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element.";}); var n={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null}; if(i)for(var s in i)s in n&&(n[s]=i[s]); if("function"!=typeof n.weightFactor){var l=n.weightFactor; n.weightFactor=function(t){return t*l;};}if("function"!=typeof n.shape)switch(n.shape){case"circle":default:n.shape="circle"; break; case"cardioid":n.shape=function(t){return 1-Math.sin(t);}; break; case"diamond":case"square":n.shape=function(t){var e=t%(2*Math.PI/4); return 1/(Math.cos(e)+Math.sin(e));}; break; case"triangle-forward":n.shape=function(t){var e=t%(2*Math.PI/3); return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e));}; break; case"triangle":case"triangle-upright":n.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3); return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e));}; break; case"pentagon":n.shape=function(t){var e=(t+.955)%(2*Math.PI/5); return 1/(Math.cos(e)+.726543*Math.sin(e));}; break; case"star":n.shape=function(t){var e=(t+.955)%(2*Math.PI/10); return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e));};}n.gridSize=Math.max(Math.floor(n.gridSize),4); var d,f,c,u,h,m,v,w=n.gridSize,g=w-n.maskGapWidth,p=Math.abs(n.maxRotation-n.minRotation),M=Math.abs(Math.floor(n.rotationSteps)),x=Math.min(n.maxRotation,n.minRotation); switch(n.color){case"random-dark":v=function(){return o(10,50);}; break; case"random-light":v=function(){return o(50,90);}; break; default:"function"==typeof n.color&&(v=n.color);}var b=null; "function"==typeof n.classes&&(b=n.classes); var C,y=!1,I=[],T=function(t){var e,r,a=t.currentTarget,i=a.getBoundingClientRect(); t.touches?(e=t.touches[0].clientX,r=t.touches[0].clientY):(e=t.clientX,r=t.clientY); var o=e-i.left,n=r-i.top,s=Math.floor(o*(a.width/i.width||1)/w),l=Math.floor(n*(a.height/i.height||1)/w); return I[s][l];},k=function(t){var e=T(t); if(C!==e)return C=e,e?void n.hover(e.item,e.dimension,t):void n.hover(void 0,void 0,t);},E=function(t){var e=T(t); e&&(n.click(e.item,e.dimension,t),t.preventDefault());},S=[],R=function(t){if(S[t])return S[t]; var e=8*t,r=e,a=[]; for(0===t&&a.push([u[0],u[1],0]); r--;){var i=1; "circle"!==n.shape&&(i=n.shape(r/e*2*Math.PI)),a.push([u[0]+t*i*Math.cos(-r/e*2*Math.PI),u[1]+t*i*Math.sin(-r/e*2*Math.PI)*n.ellipticity,r/e*2*Math.PI]);}return S[t]=a,a;},P=function(){return n.abortThreshold>0&&(new Date).getTime()-m>n.abortThreshold;},F=function(){return 0===n.rotateRatio?0:Math.random()>n.rotateRatio?0:0===p?x:M>0?x+Math.floor(Math.random()*M)*p/(M-1):x+Math.random()*p;},L=function(t,e,a){var i=!1,o=n.weightFactor(e); if(o<=n.minSize)return!1; var s=1; o<r&&(s=function(){for(var t=2; t*o<r;)t+=2; return t;}()); var l=document.createElement("canvas"),d=l.getContext("2d",{willReadFrequently:!0}); d.font=n.fontWeight+" "+(o*s).toString(10)+"px "+n.fontFamily; var f=d.measureText(t).width/s,c=Math.max(o*s,d.measureText("m").width,d.measureText("Ｗ").width)/s,u=f+2*c,h=3*c,m=Math.ceil(u/w),v=Math.ceil(h/w); u=m*w,h=v*w; var g=-f/2,p=.4*-c,M=Math.ceil((u*Math.abs(Math.sin(a))+h*Math.abs(Math.cos(a)))/w),x=Math.ceil((u*Math.abs(Math.cos(a))+h*Math.abs(Math.sin(a)))/w),b=x*w,C=M*w; l.setAttribute("width",b),l.setAttribute("height",C),i&&(document.body.appendChild(l),d.save()),d.scale(1/s,1/s),d.translate(b*s/2,C*s/2),d.rotate(-a),d.font=n.fontWeight+" "+(o*s).toString(10)+"px "+n.fontFamily,d.fillStyle="#000",d.textBaseline="middle",d.fillText(t,g*s,(p+.5*o)*s); var y=d.getImageData(0,0,b,C).data; if(P())return!1; i&&(d.strokeRect(g*s,p,f*s,c*s),d.restore()); for(var I,T,k,E=[],S=x,R=[M/2,x/2,M/2,x/2]; S--;)for(I=M; I--;){k=w; t:{for(;k--;)for(T=w; T--;)if(y[4*((I*w+k)*b+(S*w+T))+3]){E.push([S,I]),S<R[3]&&(R[3]=S),S>R[1]&&(R[1]=S),I<R[0]&&(R[0]=I),I>R[2]&&(R[2]=I),i&&(d.fillStyle="rgba(255, 0, 0, 0.5)",d.fillRect(S*w,I*w,w-.5,w-.5)); break t;}i&&(d.fillStyle="rgba(0, 0, 255, 0.5)",d.fillRect(S*w,I*w,w-.5,w-.5));}}return i&&(d.fillStyle="rgba(0, 255, 0, 0.5)",d.fillRect(R[3]*w,R[0]*w,(R[1]-R[3]+1)*w,(R[2]-R[0]+1)*w)),{mu:s,occupied:E,bounds:R,gw:x,gh:M,fillTextOffsetX:g,fillTextOffsetY:p,fillTextWidth:f,fillTextHeight:c,fontSize:o};},O=function(t,e,r,a,i){for(var o=i.length; o--;){var s=t+i[o][0],l=e+i[o][1]; if(s>=f||l>=c||s<0||l<0){if(!n.drawOutOfBound)return!1;}else if(!d[s][l])return!1;}return!0;},z=function(e,r,a,i,o,s,l,d,f){var c,u=a.fontSize; c=v?v(i,o,u,s,l):n.color; var h; h=b?b(i,o,u,s,l):n.classes; var m,g=a.bounds; m={x:(e+g[3])*w,y:(r+g[0])*w,w:(g[1]-g[3]+1)*w,h:(g[2]-g[0]+1)*w},t.forEach(function(t){if(t.getContext){var o=t.getContext("2d"),s=a.mu; o.save(),o.scale(1/s,1/s),o.font=n.fontWeight+" "+(u*s).toString(10)+"px "+n.fontFamily,o.fillStyle=c,o.translate((e+a.gw/2)*w*s,(r+a.gh/2)*w*s),0!==d&&o.rotate(-d),o.textBaseline="middle",o.fillText(i,a.fillTextOffsetX*s,(a.fillTextOffsetY+.5*u)*s),o.restore();}else{var l=document.createElement("span"),m=""; m="rotate("+-d/Math.PI*180+"deg) ",1!==a.mu&&(m+="translateX(-"+a.fillTextWidth/4+"px) scale("+1/a.mu+")"); var v={position:"absolute",display:"block",font:n.fontWeight+" "+u*a.mu+"px "+n.fontFamily,left:(e+a.gw/2)*w+a.fillTextOffsetX+"px",top:(r+a.gh/2)*w+a.fillTextOffsetY+"px",width:a.fillTextWidth+"px",height:a.fillTextHeight+"px",lineHeight:u+"px",whiteSpace:"nowrap",transform:m,webkitTransform:m,msTransform:m,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"}; c&&(v.color=c),l.textContent=i; for(var g in v)l.style[g]=v[g]; if(f)for(var p in f)l.setAttribute(p,f[p]); h&&(l.className+=h),t.appendChild(l);}});},W=function(e,r,a,i,o){if(!(e>=f||r>=c||e<0||r<0)){if(d[e][r]=!1,a){var n=t[0].getContext("2d"); n.fillRect(e*w,r*w,g,g);}y&&(I[e][r]={item:o,dimension:i});}},A=function(e,r,a,i,o,s){var l,d=o.occupied,u=n.drawMask; u&&(l=t[0].getContext("2d"),l.save(),l.fillStyle=n.maskColor); var h; if(y){var m=o.bounds; h={x:(e+m[3])*w,y:(r+m[0])*w,w:(m[1]-m[3]+1)*w,h:(m[2]-m[0]+1)*w};}for(var v=d.length; v--;){var g=e+d[v][0],p=r+d[v][1]; g>=f||p>=c||g<0||p<0||W(g,p,u,h,s);}u&&l.restore();},D=function(t){var e,r,i; Array.isArray(t)?(e=t[0],r=t[1]):(e=t.word,r=t.weight,i=t.attributes); var o=F(),s=L(e,r,o); if(!s)return!1; if(P())return!1; if(!n.drawOutOfBound){var l=s.bounds; if(l[1]-l[3]+1>f||l[2]-l[0]+1>c)return!1;}for(var d=h+1,u=function(a){var n=Math.floor(a[0]-s.gw/2),l=Math.floor(a[1]-s.gh/2),f=s.gw,c=s.gh; return!!O(n,l,f,c,s.occupied)&&(z(n,l,s,e,r,h-d,a[2],o,i),A(n,l,f,c,s,t),!0);}; d--;){var m=R(h-d); n.shuffle&&(m=[].concat(m),a(m)); var v=m.some(u); if(v)return!0;}return!1;},B=function(e,r,a){return r?!t.some(function(t){var i=document.createEvent("CustomEvent"); return i.initCustomEvent(e,!0,r,a||{}),!t.dispatchEvent(i);},this):void t.forEach(function(t){var i=document.createEvent("CustomEvent"); i.initCustomEvent(e,!0,r,a||{}),t.dispatchEvent(i);},this);},H=function(){var e=t[0]; if(e.getContext)f=Math.ceil(e.width/w),c=Math.ceil(e.height/w); else{var r=e.getBoundingClientRect(); f=Math.ceil(r.width/w),c=Math.ceil(r.height/w);}if(B("wordcloudstart",!0)){u=n.origin?[n.origin[0]/w,n.origin[1]/w]:[f/2,c/2],h=Math.floor(Math.sqrt(f*f+c*c)),d=[]; var a,i,o; if(!e.getContext||n.clearCanvas)for(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d"); e.fillStyle=n.backgroundColor,e.clearRect(0,0,f*(w+1),c*(w+1)),e.fillRect(0,0,f*(w+1),c*(w+1));}else t.textContent="",t.style.backgroundColor=n.backgroundColor,t.style.position="relative";}),a=f; a--;)for(d[a]=[],i=c; i--;)d[a][i]=!0; else{var s=document.createElement("canvas").getContext("2d"); s.fillStyle=n.backgroundColor,s.fillRect(0,0,1,1); var l=s.getImageData(0,0,1,1).data,v=e.getContext("2d").getImageData(0,0,f*w,c*w).data; a=f; for(var g,p; a--;)for(d[a]=[],i=c; i--;){p=w; t:for(;p--;)for(g=w; g--;)for(o=4; o--;)if(v[4*((i*w+p)*f*w+(a*w+g))+o]!==l[o]){d[a][i]=!1; break t;}d[a][i]!==!1&&(d[a][i]=!0);}v=s=l=void 0;}if(n.hover||n.click){for(y=!0,a=f+1; a--;)I[a]=[]; n.hover&&e.addEventListener("mousemove",k); var M=function(t){t.preventDefault();}; n.click&&(e.addEventListener("click",E),e.addEventListener("touchstart",E),e.addEventListener("touchend",M),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",k),e.removeEventListener("click",E),e.removeEventListener("touchstart",E),e.removeEventListener("touchend",M),C=void 0;});}o=0; var x,b; 0!==n.wait?(x=window.setTimeout,b=window.clearTimeout):(x=window.setImmediate,b=window.clearImmediate); var T=function(e,r){t.forEach(function(t){t.addEventListener(e,r);},this);},S=function(e,r){t.forEach(function(t){t.removeEventListener(e,r);},this);},R=function t(){S("wordcloudstart",t),b(F);}; T("wordcloudstart",R); var F=x(function t(){if(o>=n.list.length)return b(F),B("wordcloudstop",!1),void S("wordcloudstart",R); m=(new Date).getTime(); var e=D(n.list[o]),r=!B("wordclouddrawn",!0,{item:n.list[o],drawn:e}); return P()||r?(b(F),n.abort(),B("wordcloudabort",!1),B("wordcloudstop",!1),void S("wordcloudstart",R)):(o++,void(F=x(t,n.wait)));},n.wait);}}; H();}}; i.isSupported=e,i.minFontSize=r,"function"==typeof define&&define.amd?(t.WordCloud=i,define("wordcloud",[],function(){return i;})):"undefined"!=typeof module&&module.exports?module.exports=i:t.WordCloud=i;}(this);
